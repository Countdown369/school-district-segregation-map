<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Segregation Map</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v3.10.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v3.10.0/mapbox-gl.js"></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
    body {
        margin: 0;
        padding: 0;
        font-family: 'Inter', sans-serif;
        background: #f8f9fa;
    }

    #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
    }

    /* Top control panel */
    .control-panel {
        position: absolute;
        top: 20px;
        left: 20px;
        background: #ffffff;
        padding: 16px 20px;
        border-radius: 12px;
        box-shadow: 0 4px 14px rgba(0,0,0,0.12);
        width: 280px;
    }

    .control-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 10px;
    }

    .control-group label {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 0;
        cursor: pointer;
        font-size: 14px;
    }

    input[type="radio"] {
        accent-color: #3b82f6;
        width: 16px;
        height: 16px;
    }
    
    .sidebar-description {
    position: absolute;
    top: 170px;      /* pushes it below your control-panel */
    left: 20px;
    width: 280px;    /* consistent with your control-panel width */
    background: #ffffff;
    padding: 14px 16px;
    border-radius: 10px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.10);
    font-size: 14px;
    line-height: 1.45;
    z-index: 10;
}


    /* Hover info card */
    .info-card {
        position: absolute;
        bottom: 30px;
        left: 20px;
        background: #ffffff;
        padding: 18px 22px;
        width: 280px;
        border-radius: 12px;
        box-shadow: 0 4px 14px rgba(0,0,0,0.12);
    }
    .info-card h2 {
        margin: 0 0 8px 0;
        font-size: 17px;
        font-weight: 600;
    }
    .info-card p {
        margin: 4px 0;
        font-size: 14px;
    }
    
    .legend {
    position: absolute;
    right: 20px;
    bottom: 40px;
    background: #ffffff;
    padding: 14px 16px;
    border-radius: 10px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.10);
    width: 160px;
    font-size: 14px;
    z-index: 10;
    }

    .legend-title {
        font-weight: 600;
        margin-bottom: 8px;
    }

    .legend-scale {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .legend-color {
        display: inline-block;
        width: 28px;
        height: 14px;
        border-radius: 3px;
    }

</style>
</head>
<body>
<div id="map"></div>

<!-- Control Panel -->
<div class="control-panel">
    <div class="control-title">Select Racial Segregation Index</div>
    <div class="control-group">
        <label>
            <input id="cm7qf911301jv01qv0g225f0j" type="radio" name="rtoggle" value="cm7qf911301jv01qv0g225f0j" checked>
            Mutual Information Index
        </label>
        <label>
            <input id="cm7qhyvpe000d01s02tga1ppi" type="radio" name="rtoggle" value="cm7qhyvpe000d01s02tga1ppi">
            Atkinson Index (Nation)
        </label>
    </div>
</div>
    
<div class="sidebar-description" style="
    margin-top: 14px;
    padding: 14px 16px;
    background: #ffffff;
    border-radius: 10px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.10);
    font-size: 14px;
    line-height: 1.45;
">
    This map shows school year 2022–23 segregation indexes in US public school districts
    in order to compare US public school districts against each other in terms of racial
    segregation. It is based on the Mutual Information Index and Atkinson Index (the former
    using national racial demographic weightings) defined within the 2011 article
    <a href="https://doi.org/10.1016/j.jet.2010.10.008" target="_blank"><em>“Measuring school segregation”</em></a>
    by David M. Frankel and Oscar Volij.
    School enrollment data comes from the
    <a href="https://nces.ed.gov/ccd/files.asp" target="_blank">Common Core of Data</a>
    provided by the US National Center for Education Statistics.
</div>


<!-- Info Card -->
<div class="info-card">
    <h2 id="info-title">Segregation Index</h2>
    <div id="pd"><p>Hover over a district!</p></div>
</div>
    
<div class="legend">
    <div class="legend-title">Index Value</div>
    <div class="legend-scale">
        <div class="legend-item">
            <span class="legend-color" style="background:#ffffff; border:1px solid #bbb"></span>
            <span>0 (Low)</span>
        </div>
        <div class="legend-item">
            <span class="legend-color" style="background:#f05800; border:1px solid #bbb;"></span>
            <span>1 (High)</span>
        </div>
        <div class="legend-item">
            <span class="legend-color" style="background:#b6dfad; border:1px solid #bbb;"></span>
            <span>No data</span>
        </div>
    </div>
</div>

<script>
    const propertyMap = {
        'cm7qf911301jv01qv0g225f0j': {property: 'DistMutual', title: "Mutual Information Index"},
        'cm7qhyvpe000d01s02tga1ppi': {property: 'DistNationAtkinson', title: "Atkinson Index (Nation)"}
    };

    let currentProperty = propertyMap['cm7qf911301jv01qv0g225f0j'].property;
    let currentTitle = propertyMap['cm7qf911301jv01qv0g225f0j'].title;
    document.getElementById('info-title').textContent = currentTitle;

    mapboxgl.accessToken = 'pk.eyJ1IjoiY2Ficm93bjgwMiIsImEiOiJjbDJhd2w3c3gwOW5nM2NxYXQ4bG15Y3VsIn0.741svQSpMev_SFMZ9t7V_Q';

    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/cabrown802/cm7qf911301jv01qv0g225f0j',
        center: [-101.88481, 39.53962],
        zoom: 3.4,
        minZoom: 3
    });

    map.on('load', () => {
        map.getCanvas().style.cursor = 'default';
    });

    map.on('mousemove', (event) => {
        const states = map.queryRenderedFeatures(event.point, {
            layers: ['hello-world']
        });
        document.getElementById('pd').innerHTML = states.length
            ? `<h3>${states[0].properties.NAME}</h3><p><strong>${states[0].properties[currentProperty]?.toFixed(3)}</strong></p>`
            : `<p>Hover over a district.</p>`;
    });

    const inputs = document.querySelectorAll('input[type="radio"]');

    inputs.forEach(input => {
        input.onclick = (layer) => {
            const layerId = layer.target.id;
            map.setStyle('mapbox://styles/cabrown802/' + layerId);

            if (propertyMap[layerId]) {
                currentProperty = propertyMap[layerId].property;
                currentTitle = propertyMap[layerId].title;
            }
            document.getElementById('info-title').textContent = currentTitle;
        };
    });
</script>

</body>
</html>
